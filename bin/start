#!/bin/bash
#
# DMC Start Script
########################################################################

check_env() {
	for x in ${ENVIRONMENTS[@]}; do
		(( $(docker images | grep ^gurumojo | grep -c "$x") )) || return 1
	done
}

check_img() {
	for x in ${CONTAINERS[@]}; do
		IMAGE=$(echo "$x" | sed 's;.*"image":"\([^,]*\)".*;\1;')
		(( $(docker images | grep -c "^$IMAGE") )) || return 1
	done
}

wake() {
	check_img && bin/wake || bin/build && bin/wake
}


# source configuration
. bin/env

# fire up our batch process
check_env && wake || bin/init

# query docker environment
bin/dmc -q

