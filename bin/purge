#!/bin/bash
#
# DMC Purge Script
########################################################################

destroy() {
	echo "CONTAINERS"
	for CONTAINER in ${CONTAINERS[@]}; do
		docker kill "$CONTAINER"
		docker rm -f "$CONTAINER"
	done
	echo "IMAGES"
	for IMAGE in ${IMAGES[@]}; do
		docker rmi -f "$IMAGE"
	done
	echo "VOLUMES"
	for VOLUME in ${VOLUMES[@]}; do
		docker volume rm "$VOLUME"
	done
}

search() {
	CONTAINERS=$(docker ps -a | grep -v ^CONTAINER | awk '{print $1}')
	IMAGES=$(docker images | grep -v -e ^REPOSITORY -e ^node | awk '{print $3}')
	VOLUMES=$(docker volume ls | grep -v ^DRIVER | awk '{print $2}')
}


# source configuration
. bin/env

# fire up our batch process
search && destroy

