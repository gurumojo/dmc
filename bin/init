#!/bin/bash
#
# DMC Bootstrap Script
########################################################################

check() {
	for x in ${ENVIRONMENTS[@]}; do
		(( $(docker images | grep ^gurumojo | grep -c "$x") )) || return 1
	done
}

initialize() {
	for x in ${ENVIRONMENTS[@]}; do
		echo "INIT ENVIRONMENT $x"
		$(bin/dmc -b -i gurumojo -t "$x") || echo "INIT $x FAIL!" && return 1
	done
}


# source configuration
. bin/env

# bootstrap docker environments
check || initialize

# empty storage from previous runs
bin/purge

# build configured images
bin/build

# activate containers
bin/wake

